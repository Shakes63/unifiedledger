COMPLETED BUGS:
âœ… 1. the category and accounts dropdown on the bill form are not connected to the categories and accounts
âœ… 2. when creating a new transaction the default date should be today
âœ… 3. There should be a way to mark an account as being a Business Account and that should trigger the sales tax tracking for that account.
âœ… 4. If there are multiple business accounts the sales tax should be tracked separately.
âœ… 5. Everywhere that you can add a category or tag there should be an option to create them inline.
âœ… 6. there should be some padding in between the sidebar and the page content. The dashboard is a good example of the amount of padding it should have. Check all of the pages and ensure the padding is like the dashboard page.
âœ… 7. When trying to create an account the submit button is not creating the account.
âœ… 8. the dropdowns across the app are completely transparent, turn up the opacity so that they can be read easier.
âœ… 9. when creating a transaction there should only be a transfer type instead of transfer in and transfer out. If Transfer is selected it should show a From Account and To Account dropdowns.
âœ… 10. the transaction form is doubled up there should only be one.
âœ… 11. make the cards on the categories page more compact.
âœ… 12. Account creation was failing with 500 error - fixed missing is_business_account database column
âœ… 13. Sidebar dashboard was highlighted even when a different option was selected - fixed isActive() function
âœ… 14. Transfer form showed duplicate "Account" labels - fixed by making AccountSelector label customizable
âœ… 15. Category cards were too large - made them significantly smaller (p-2, reduced fonts, gap-2)
âœ… 16. Categories couldn't be marked as tax deductible - added isTaxDeductible field and toggle UI
âœ… 17. BillsWidget error "data.filter is not a function" - API returns {data: [...], total, limit, offset} but component expected array. Fixed by extracting data.data and handling both array and object responses
âœ… 18. Added Merchant field to transactions with inline creation feature:
   - Added merchantId field to transactions table in schema
   - Created database migration 0005_add_merchant_id.sql
   - Enhanced /api/merchants/route.ts with POST endpoint for creating merchants
   - Created /api/merchants/[id]/route.ts for PUT (update) and DELETE operations
   - Created MerchantSelector component with inline creation (similar to CategorySelector)
   - Integrated MerchantSelector into TransactionForm (hidden for transfers)
   - Created full Merchants management page at /dashboard/merchants with list, edit, delete, create
   - Added "Merchants" link to sidebar in Tools section
   - Merchants support usage count tracking and are sorted by usage

âœ… 19. Separated merchants and description fields:
   - Removed MerchantAutocomplete from description field
   - Description field is now plain Input component
   - Merchant field is selected via separate MerchantSelector component
   - Merchant suggestions no longer appear in description field

âœ… 20. Fixed internal server error when selecting description from dropdown:
   - Root cause: MerchantAutocomplete suggestion dropdown was causing errors
   - Solution: Replaced MerchantAutocomplete with plain Input for description

âœ… 21. Added merchant and transfer information to transaction table display:
   - Shows merchant name if available
   - For transfers, shows "From Account â†’ To Account" format
   - Added helper functions: getMerchantName, getAccountName, getTransactionDisplay
   - Transfer icon shows ArrowRightLeft in blue color
   - Reduced vertical space: p-4â†’p-2, space-y-3â†’space-y-2, removed type badge
   - Transactions now take up ~50% less vertical space

âœ… 22. Fixed transaction creation 500 error - merchantId not handled:
   - Root cause: merchantId field added to schema/form but not extracted in API endpoints
   - POST /api/transactions now extracts merchantId from request body
   - PUT /api/transactions/[id] now supports merchantId updates
   - Removed old auto-merchant creation logic (conflicted with new MerchantSelector)
   - Now only tracks merchant usage when merchantId is explicitly provided
   - Updated validation to check for merchantId in update checks

âœ… 23. Fixed 500 error on GET /api/transactions - better-sqlite3 bindings issue:
   - Root cause: Native bindings for better-sqlite3 weren't built
   - Solution: Cleaned .next directory and reinstalled dependencies with pnpm
   - pnpm install --force triggered proper build of better-sqlite3 native bindings
   - API now responds with {"error":"Unauthorized"} (expected Clerk auth error)
   - Transactions page should now load properly when authenticated

âœ… 24. Fixed 500 error on GET /api/transactions - missing merchant_id column:
   - Root cause: Database migration 0005_add_merchant_id.sql wasn't applied to sqlite.db
   - Error: SqliteError: no such column: "merchant_id"
   - Solution: Created migration script to apply pending migrations manually
   - Applied migration: 0005_add_merchant_id (added merchant_id column and index)
   - API now returns proper Unauthorized error (authentication working)
   - RecentTransactions widget should now load when user is authenticated

âœ… 25. Fixed recent transactions not showing merchant information:
   - Root cause: RecentTransactions component wasn't fetching or displaying merchant data
   - Missing: merchantId in Transaction interface, merchants/accounts state, helper functions
   - Solution:
     - Added merchantId, transferId to Transaction interface
     - Added Merchant and Account interfaces
     - Added merchants and accounts state
     - Fetch merchants and accounts data in useEffect
     - Added getMerchantName, getAccountName, getTransactionDisplay helper functions
     - Updated transaction display to show merchant name instead of just description
     - Updated repeat transaction logic to include merchantId
   - RecentTransactions widget now shows merchant names for transactions with merchants
   - Falls back to description if merchant not available
   - Handles transfers by showing "FromAccount â†’ ToAccount" format

âœ… 26. Fixed transaction page params Promise error:
   - Error: "A param property was accessed directly with `params.id`. `params` is a Promise..."
   - Root cause: Next.js 16 made params a Promise in dynamic routes
   - Solution:
     - Changed params interface type from object to Promise<{id: string}>
     - Imported React
     - Used React.use(params) to unwrap the Promise
     - Updated transactionId prop to use resolvedParams.id
   - Transaction details page now loads without errors

âœ… 27. Fixed household page showing owner with no name:
   - Root cause: When creating household and when accepting invitations, userName wasn't being fetched from Clerk
   - Solution:
     - Imported clerkClient from '@clerk/nextjs/server'
     - In /api/households/route.ts POST: Fetch user from Clerk, extract firstName+lastName or firstName or username
     - In /api/invitations/accept/route.ts POST: Same approach for invited members
     - Now passes proper userName to householdMembers when creating records
   - Household members now display with their full names instead of blank

âœ… 28. Fixed TransactionDetails component bgColor undefined error:
   - Error: "Cannot read properties of undefined (reading 'bgColor')" at line 159
   - Root cause: Transaction type was changed to 'transfer' but typeConfig and interface still referenced 'transfer_in'/'transfer_out'
   - Solution:
     - Updated Transaction interface type to include 'transfer' alongside 'transfer_in'/'transfer_out'
     - Added 'transfer' entry to typeConfig object
     - Added fallback to typeConfig.expense if type not found: `typeConfig[transaction.type as keyof typeof typeConfig] || typeConfig.expense`
     - Updated sign calculation to handle 'transfer' type
   - Transaction details page now loads without errors for all transaction types

âœ… 29. Fixed tax dashboard and sales tax pages throwing errors with no data:
   - Root cause: Pages tried to render charts and tables with empty data arrays
   - Solution for Tax Dashboard:
     - Added hasData check (data.summary.byCategory.length > 0)
     - Added hasDeductions check for filtering tax-deductible items
     - Wrapped all content sections (metrics, charts, tables, tips) with conditional rendering
     - Added friendly empty state card with FileText icon
     - Shows helpful message: "No Tax Data Available" with instructions
   - Solution for Sales Tax Dashboard:
     - Added hasData check (data.quarters.length > 0)
     - Wrapped all content sections (metrics, chart, filing status, deadlines, tips) with conditional rendering
     - Added empty state card with DollarSign icon
     - Shows helpful message with step-by-step setup instructions
   - Both pages now gracefully handle empty data without errors
   - Year selector still available to check other years
   - Updated files: app/dashboard/tax/page.tsx, app/dashboard/sales-tax/page.tsx

âœ… 30. Updated transaction display layout to show merchant, description, and account:
   - Root cause: Transaction list showed only merchant OR description, not both
   - Solution:
     - Refactored getTransactionDisplay() to return object with merchant and description separately
     - New layout structure:
       * Merchant name (bold, white, top line) - if merchant exists
       * Description (gray text below merchant, or main text if no merchant)
       * Date and split indicator (gray text)
       * Amount (right side, green for income, white for expenses)
       * Account name (below amount, gray text with 100px max width)
     - Transfer transactions show "FromAccount â†’ ToAccount" as description
     - When no merchant: description appears as bold main text
     - When merchant exists: merchant bold on top, description gray below
   - Updated file: app/dashboard/transactions/page.tsx
   - New display provides better context with both merchant and description visible

âœ… 31. Delete transactions functionality - Already implemented:
   - Feature request: "There should be a way to delete transactions"
   - Status: Already fully working
   - Location: Transaction details page at /dashboard/transactions/[id]
   - UI Features:
     - Delete button with Trash2 icon in top right corner
     - Red destructive button styling
     - Confirmation dialog: "Are you sure you want to delete this transaction? This action cannot be undone."
     - Loading state ("Deleting...") while processing
     - Success toast notification on completion
     - Auto-redirects back to transactions list after deletion
   - API Features:
     - DELETE endpoint at /api/transactions/[id]/route.ts (lines 236-327)
     - Verifies user authentication and transaction ownership
     - Automatically deletes associated transaction splits
     - Reverses balance changes on the account (using Decimal.js)
     - Proper error handling and logging
   - Files: components/transactions/transaction-details.tsx, app/api/transactions/[id]/route.ts

âœ… 32. Removed transfers page and added account-based transaction filtering:
   - Part 1: Remove transfers page
     - Removed "Transfers" link from sidebar navigation (Financial section)
     - Removed ArrowRightLeft icon import (no longer used)
     - Transfers can now only be created via transaction form (type: "Transfer")
   - Part 2: Account-based transaction filtering
     - Added "View Transactions" button to AccountCard with ArrowRight icon
     - Button links to `/dashboard/transactions?accountId={accountId}`
     - Enhanced transactions page to accept accountId URL parameter
     - Auto-filters transactions by account when accountId is present in URL
     - Updated page header to show account name when filtered
       * "Account Name Transactions" instead of just "Transactions"
       * Subtitle shows "X transactions for this account"
     - Uses useSearchParams hook for URL parameter handling
     - Automatic search trigger when account filter is detected
   - Files updated:
     - components/accounts/account-card.tsx (added View Transactions button)
     - components/navigation/sidebar.tsx (removed Transfers link)
     - app/dashboard/transactions/page.tsx (added URL parameter handling and auto-filtering)
   - User experience:
     - Click account card â†’ immediately see all transactions for that account
     - Transfer creation handled through standard transaction form
     - Cleaner navigation with one less menu item

âœ… 33. Updated transaction type filters to use unified transfer type:
   - Root cause: Advanced search still showed "Transfer In" and "Transfer Out" filters
   - Solution:
     - Updated transactionTypes array in advanced-search.tsx
     - Replaced two separate transfer types with single "Transfer" option
     - Old: transfer_in (Transfer In), transfer_out (Transfer Out)
     - New: transfer (Transfer)
     - Matches the unified transfer type system implemented in bug #32
   - File updated: components/transactions/advanced-search.tsx (lines 75-79)
   - Result: Search filters now correctly align with current transaction type system

âœ… 34. Fixed bills API 500 Internal Server Error:
   - Root cause: Invalid SQL query in GET /api/bills endpoint
   - Issue: Query was trying to select `upcomingInstance: billInstances` but billInstances was never joined to the query
   - This caused a SQL error when the query executed
   - Solution:
     - Removed `upcomingInstance: billInstances` from all three select statements (lines 31, 45, 59)
     - Upcoming instances are already fetched separately with a proper query (lines 79-98)
     - Query now only selects: bill, category (leftJoin), account (leftJoin)
   - Files updated: app/api/bills/route.ts
   - Result: Bills page now loads successfully without errors
   - Also fixes: Merchant deletion error (was same bills API error)

âœ… 35. Added bill details page with delete functionality:
   - Root cause: Bills had no way to view details or delete them (unlike transactions)
   - Solution:
     - Created BillDetails component (components/bills/bill-details.tsx)
       * Displays full bill information (name, amount, due date, category, account, notes)
       * Shows overdue, upcoming, and paid bill instances
       * Includes Edit and Delete buttons with confirmation
       * Auto-redirects to bills list after deletion
     - Created bill details page route (app/dashboard/bills/[id]/page.tsx)
     - Created bill edit page route (app/dashboard/bills/edit/[id]/page.tsx)
       * Fetches existing bill data and populates form
       * Uses same BillForm component as create page
       * Updates bill via PUT /api/bills/[id]
     - Updated bills list page (app/dashboard/bills/page.tsx)
       * Made all BillItem components clickable links to details page
       * Added cursor-pointer styling for better UX
   - DELETE API endpoint already existed at /api/bills/[id]/route.ts
     * Deletes bill and all associated bill instances
     * Includes authentication and ownership verification
   - Files created:
     * components/bills/bill-details.tsx
     * app/dashboard/bills/[id]/page.tsx
     * app/dashboard/bills/edit/[id]/page.tsx
   - Files updated:
     * app/dashboard/bills/page.tsx
   - Result: Bills now have full details view with edit and delete functionality

âœ… 36. Fixed household member names not displaying (bug 27 reopened):
   - Root cause: Existing household members in database had null/empty userName field
   - Previous fix (bug 27) only addressed new members created after the fix
   - Old data created before the fix still had empty userName values
   - Additional issue: clerkClient usage was incorrect for newer Clerk SDK
   - Solution:
     - Enhanced GET /api/households/[householdId]/members/route.ts
       * Added automatic backfill logic when fetching members
       * Checks if userName is missing or empty for each member
       * Fetches user info from Clerk API (firstName, lastName, username)
       * Updates database with userName for future requests
       * Returns updated member list with names populated
     - Created manual backfill endpoint at /api/households/backfill-names/route.ts
       * Can be called to bulk update all members at once
       * Useful for one-time migration if needed
     - Fixed clerkClient usage across all files
       * Changed from `clerkClient.users.getUser()` to `(await clerkClient()).users.getUser()`
       * clerkClient is a function in newer SDK, must be called first
   - Files updated:
     * app/api/households/[householdId]/members/route.ts (automatic backfill + clerkClient fix)
     * app/api/households/route.ts (clerkClient fix)
     * app/api/invitations/accept/route.ts (clerkClient fix)
   - Files created:
     * app/api/households/backfill-names/route.ts (manual backfill)
   - Result: Household page now automatically fixes missing names when loaded
   - Names display properly as "FirstName LastName" instead of blank

âœ… 37. Updated RecentTransactions to match transactions page display:
   - Root cause: Recent transactions widget showed different layout than transactions page
   - Missing merchant/description separation, account name, split indicator
   - Solution:
     - Updated getTransactionDisplay() to return object with {merchant, description} instead of string
     - Added isSplit field to Transaction interface
     - Updated transaction item layout to match transactions page exactly:
       * Merchant name on top (bold) if exists
       * Description below merchant (gray) or standalone (bold) if no merchant
       * Date and split indicator in gray
       * Amount on right (green for income, white for expense)
       * Account name below amount (gray, max 100px width)
       * Copy/repeat button with proper sizing (h-7 w-7)
     - Updated getTransactionIcon to handle unified 'transfer' type
     - Reduced card padding from p-4 to p-2 to match transactions page
     - Reduced spacing from space-y-3 to space-y-2
     - Made entire card clickable as Link to transaction details
   - Files updated:
     * components/dashboard/recent-transactions.tsx
   - Result: Recent transactions now display identically to transactions page
   - Consistent user experience across dashboard and transactions page

âœ… 38. Fixed duplicate/repeat transaction error in RecentTransactions (FIRST FIX):
   - Error: "Cannot read properties of undefined (reading 'toFixed')" at line 235
   - Root cause: POST /api/transactions returns {id, message, appliedCategoryId, ...} not full transaction object
   - handleRepeatTransaction was adding incomplete object to state
   - Missing fields: amount, description, type, date, etc.
   - Solution:
     - Updated handleRepeatTransaction to construct full Transaction object from API response + original data
     - Maps result.id to new transaction id
     - Copies all other fields from original transaction (amount, description, type, etc.)
     - Uses result.appliedCategoryId if rules applied a category
     - Sets date to today's date
     - Sets isSplit to false for new transactions
   - Files updated:
     * components/dashboard/recent-transactions.tsx
   - Result: Duplicate transaction button now works without errors
   - New transaction appears correctly in list with all fields populated

âœ… 39. Fixed duplicate/repeat transaction error AGAIN (bug 7 reopened - Part 1):
   - Error: "Cannot read properties of undefined (reading 'toFixed')" still occurring after bug 38 fix
   - Transaction was created successfully in DB but error threw in UI
   - After refresh, duplicated transaction appeared correctly
   - Root cause: Type mismatch between API response data format and manually constructed newTransaction object
   - The manual state manipulation approach was fragile and prone to type inconsistencies
   - Solution:
     - Added type safety for amount field: checks if number, otherwise parses float with fallback to 0
     - Changed approach from manual state manipulation to refetching transactions after duplicate
     - Now calls GET /api/transactions?limit=5 after successful POST
     - This ensures UI always has same data structure as initial load
     - Matches the "refresh" behavior that was working correctly
   - Files updated:
     * components/dashboard/recent-transactions.tsx (lines 104, 115-119)
   - Result: Duplicate button now works reliably without errors on dashboard
   - UI always reflects true database state with proper data types

âœ… 39b. Fixed duplicate/repeat transaction error on transactions page (bug 7 reopened - Part 2):
   - Error: "Cannot read properties of undefined (reading 'toFixed')" at app/dashboard/transactions/page.tsx:402
   - Same issue as Part 1 but on the transactions page instead of dashboard
   - Root cause: Transactions page was also using manual state manipulation (line 208-209)
   - Code: `const newTransaction = await response.json(); setTransactions([newTransaction, ...transactions]);`
   - API returns {id, message, appliedCategoryId} not full transaction object
   - Solution:
     - Changed to refetch transactions after successful POST
     - Checks if currentFilters exists to determine search mode vs. initial mode
     - If in search mode: calls performSearch(currentFilters, paginationOffset)
     - If in initial mode: fetches from /api/transactions?limit=100
     - Same pattern as dashboard fix - refetch instead of manual state manipulation
     - Ensures data consistency across both pages
   - Files updated:
     * app/dashboard/transactions/page.tsx (lines 208-222)
   - Result: Duplicate button works on both dashboard AND transactions page
   - Works correctly in both search mode and regular view mode
   - No more toFixed errors anywhere in the app

âœ… 40. Fixed transaction deletion failing for unified transfer type:
   - Error: "Failed to delete transaction" when trying to delete any transaction
   - Root cause: DELETE endpoint checking for 'transfer_out' but unified transfer type is now just 'transfer'
   - This caused balance reversal logic to fail (lines 294, 178, 191 in route.ts)
   - When deleting a transfer, the condition `transaction.type === 'expense' || transaction.type === 'transfer_out'` didn't match 'transfer'
   - Solution:
     - Updated DELETE endpoint balance reversal to include 'transfer' type (line 294)
     - Updated PUT endpoint balance reversal to include 'transfer' type (lines 178, 191)
     - Added clarifying comments for transfer handling
   - Files updated:
     * app/api/transactions/[id]/route.ts (lines 178, 191, 294)
   - Result: Transaction deletion now works for all transaction types including unified transfers
   - Balance reversal correctly handles expenses, transfers, and income

âœ… 41. Created Rules Management Page:
   - Issue: Sidebar had link to /dashboard/rules but page didn't exist (404)
   - API endpoints already existed (/api/rules) and components were built (RuleBuilder, BulkApplyRules)
   - Created comprehensive rules page at /dashboard/rules/page.tsx
   - Features implemented:
     - List all rules with priority, status, match count, last used date
     - Create new rules (opens RuleBuilder)
     - Edit existing rules
     - Delete rules with confirmation
     - Toggle rules active/inactive
     - Change rule priority (move up/down)
     - Bulk apply rules to existing transactions
     - Empty state for first-time users
     - Info card explaining how rules work
     - Clean dark mode design matching app style
   - Files created:
     * app/dashboard/rules/page.tsx (full page implementation)
   - Result: Rules page is now fully functional and accessible from sidebar
   - Users can create, edit, delete, and manage auto-categorization rules

âœ… 42. Fixed merchant spending charts tracking description instead of merchant:
   - Issue: Reports page merchant analysis was grouping by transaction description instead of actual merchants
   - Root cause: groupByMerchant function in lib/reports/report-utils.ts was using txn.description (line 114)
   - TransactionData interface didn't include merchantId field
   - merchant-analysis API route wasn't fetching merchant names
   - Solution:
     - Added merchantId field to TransactionData interface
     - Updated groupByMerchant to use merchantId when available, falls back to description
     - Updated merchant-analysis route to fetch merchant records from database
     - Created merchantMap to convert merchantId to merchant name
     - Fixed summary statistics to use merchantId instead of description (lines 75, 79)
   - Files updated:
     * lib/reports/report-utils.ts (added merchantId to interface, updated groupByMerchant function)
     * app/api/reports/merchant-analysis/route.ts (added merchant name lookup, fixed summary)
   - Result: Merchant spending charts now correctly track and display actual merchant names
   - Transactions with merchants show proper merchant names in reports
   - Transactions without merchants fall back to description (backward compatible)

âœ… 43. Fixed account name being cut off in transaction entry:
   - Issue: Account names were truncated without proper text ellipsis in dropdowns
   - Occurred in both AccountSelector component and transfer "To Account" selector
   - Root cause: Account name span didn't have truncate classes or proper flex behavior
   - Long account names would overflow and get cut off awkwardly
   - Solution:
     - Added w-full to flex container for proper width distribution
     - Made DollarSign icon flex-shrink-0 to prevent icon from shrinking
     - Added flex-1 truncate to account name span for proper text truncation with ellipsis
     - Made balance span flex-shrink-0 to keep it fully visible
     - Applied same fix to both AccountSelector and "To Account" in transaction form
   - Files updated:
     * components/transactions/account-selector.tsx (lines 71-76)
     * components/transactions/transaction-form.tsx (lines 649-653)
   - Result: Account names now properly truncate with ellipsis (...) when too long
   - Icon and balance remain fully visible while name gracefully truncates
   - Better UX for users with long account names

âœ… 44. Implemented account update functionality:
   - Issue: Update Account button showed error "Account editing not yet implemented"
   - Root cause: PUT endpoint didn't exist in app/api/accounts/[id]/route.ts
   - Frontend had TODO comment (line 59-62) that returned early with error message
   - Solution:
     - Created PUT endpoint in app/api/accounts/[id]/route.ts
     - Accepts: name, type, bankName, accountNumberLast4, currentBalance, creditLimit, color, icon, isBusinessAccount
     - Validates user authentication and account ownership
     - Validates required fields (name and type)
     - Preserves existing values for fields not provided in update
     - Updates account with new values and sets updatedAt timestamp
     - Updated accounts page handleSubmit to call PUT when selectedAccount exists
     - Changed method from always POST to conditional PUT/POST based on edit mode
     - Updated all toast messages to reflect create vs update appropriately
     - Updated console error messages for better debugging
   - Files updated:
     * app/api/accounts/[id]/route.ts (added PUT endpoint, lines 8-88)
     * app/dashboard/accounts/page.tsx (implemented update logic, lines 54-98)
   - Result: Update Account button now fully functional
   - Users can edit account name, type, bank info, balances, and business account status
   - Proper success/error messages for both create and update operations

âœ… 45. Added New Transaction button to transactions page:
   - Issue: Transactions page had no quick way to create a new transaction
   - Users had to go back to dashboard to add transactions
   - Solution:
     - Added Plus icon to lucide-react imports
     - Created "New Transaction" button in toolbar section (next to Import CSV)
     - Button uses emerald styling to match app theme (bg-emerald-500)
     - Links to /dashboard/transactions/new page
     - Button includes Plus icon for visual clarity
     - Grouped both buttons (New Transaction + Import CSV) in flex container
   - Files updated:
     * app/dashboard/transactions/page.tsx (lines 4, 331-350)
   - Result: Users can now quickly create transactions from the transactions page
   - Better UX - one less click to add a transaction
   - Consistent with other pages that have create buttons

ALL BUGS FIXED! ðŸŽ‰


